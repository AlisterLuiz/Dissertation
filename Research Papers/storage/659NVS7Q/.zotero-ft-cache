arXiv:1804.03999v3 [cs.CV] 20 May 2018

Attention U-Net: Learning Where to Look for the Pancreas
Ozan Oktay1,5, Jo Schlemper1, Loic Le Folgoc1, Matthew Lee4, Mattias Heinrich3, Kazunari Misawa2, Kensaku Mori2, Steven McDonagh1, Nils Y Hammerla5, Bernhard Kainz1, Ben Glocker1, and Daniel Rueckert1
1Biomedical Image Analysis Group, Imperial College London, London, UK 2Dept. of Media Science, Nagoya University & Aichi Cancer Center, JP
3Medical Informatics, University of Luebeck, DE, 4HeartFlow, California, USA 5Babylon Health, London, UK
Abstract
We propose a novel attention gate (AG) model for medical imaging that automatically learns to focus on target structures of varying shapes and sizes. Models trained with AGs implicitly learn to suppress irrelevant regions in an input image while highlighting salient features useful for a speciﬁc task. This enables us to eliminate the necessity of using explicit external tissue/organ localisation modules of cascaded convolutional neural networks (CNNs). AGs can be easily integrated into standard CNN architectures such as the U-Net model with minimal computational overhead while increasing the model sensitivity and prediction accuracy. The proposed Attention U-Net architecture is evaluated on two large CT abdominal datasets for multi-class image segmentation. Experimental results show that AGs consistently improve the prediction performance of U-Net across different datasets and training sizes while preserving computational efﬁciency. The source code for the proposed architecture is publicly available.
1 Introduction
Automated medical image segmentation has been extensively studied in the image analysis community due to the fact that manual, dense labelling of large amounts of medical images is a tedious and error-prone task. Accurate and reliable solutions are desired to increase clinical work ﬂow efﬁciency and support decision making through fast and automatic extraction of quantitative measurements.
With the advent of convolutional neural networks (CNNs), near-radiologist level performance can be achieved in automated medical image analysis tasks including cardiac MR segmentation [3] and cancerous lung nodule detection [17]. High representation power, fast inference, and ﬁlter sharing properties have made CNNs the de facto standard for image segmentation. Fully convolutional networks (FCNs) [18] and the U-Net [24] are two commonly used architectures. Despite their good representational power, these architectures rely on multi-stage cascaded CNNs when the target organs show large inter-patient variation in terms of shape and size. Cascaded frameworks extract a region of interest (ROI) and make dense predictions on that particular ROI. The application areas include cardiac MRI [14], cardiac CT [23], abdominal CT [26, 27] segmentation, and lung CT nodule detection [17]. However, this approach leads to excessive and redundant use of computational resources and model parameters; for instance, similar low-level features are repeatedly extracted by all models within the cascade. To address this general problem, we propose a simple and yet effective solution, namely attention gates (AGs). CNN models with AGs can be trained from scratch in a standard way similar to the training of a FCN model, and AGs automatically learn to focus on target
1st Conference on Medical Imaging with Deep Learning (MIDL 2018), Amsterdam, The Netherlands.

structures without additional supervision. At test time, these gates generate soft region proposals implicitly on-the-ﬂy and highlight salient features useful for a speciﬁc task. Moreover, they do not introduce signiﬁcant computational overhead and do not require a large number of model parameters as in the case of multi-model frameworks. In return, the proposed AGs improve model sensitivity and accuracy for dense label predictions by suppressing feature activations in irrelevant regions. In this way, the necessity of using an external organ localisation model can be eliminated while maintaining the high prediction accuracy. Similar attention mechanisms have been proposed for natural image classiﬁcation [11] and captioning [1] to perform adaptive feature pooling, where model predictions are conditioned only on a subset of selected image regions. In this paper, we generalise this design and propose image-grid based gating that allows attention coefﬁcients to be speciﬁc to local regions. Moreover, our approach can be used for attention-based dense predictions.
We demonstrate the implementation of AG in a standard U-Net architecture (Attention U-Net) and apply it to medical images. We choose the challenging CT pancreas segmentation problem to provide experimental evidence for our proposed contributions. This problem constitutes a difﬁcult task due to low tissue contrast and large variability in organ shape and size. We evaluate our implementation on two commonly used benchmarks: TCIA Pancreas CT -82 [25] and multi-class abdominal CT -150. The results show that AGs consistenly improve prediction accuracy across different datasets and training sizes while achieving state-of-the-art performance without requiring multiple CNN models.
1.1 Related Work
CT Pancreas Segmentation: Early work on pancreas segmentation from abdominal CT used statistical shape models [5, 28] or multi-atlas techniques [22, 34]. In particular, atlas approaches beneﬁt from implicit shape constraints enforced by propagation of manual annotations. However, in public benchmarks such as the TCIA dataset [25], Dice similarity coefﬁcients (DSC) for atlas-based frameworks ranges from 69.6% to 73.9% [22, 34]. In [39] a classiﬁcation based framework is proposed to remove the dependency of atlas to image registration. Recently, cascaded multi-stage CNN models [26, 27, 38] have been proposed to address the problem. Here, an initial coarse-level model (e.g. U-Net or Regression Forest) is used to obtain a ROI and then a cropped ROI is used for segmentation reﬁnement by a second model. Similarly, combinations of 2D-FCN and recurrent neural network (RNN) models are utilised in [4] to exploit dependencies between adjacent axial slices. These approaches achieve state-of-the-art performance in the TCIA benchmark (81.2% − 82.4% DSC). Without using a cascaded framework, the performance drops between 2.0% and 4.4%. Recent work [37] proposed an iterative two-stage model that recursively updates local and global predictions, and both models are trained end-to-end. Besides standard FCNs, dense connections [6] and sparse convolutions [8, 9] have been applied to the CT pancreas segmentation problem. Dense connections and sparse kernels reduce computational complexity by requiring less number of non-zero parameters.
Attention Gates: AGs are commonly used in natural image analysis, knowledge graphs, and language processing (NLP) for image captioning [1], machine translation [2, 30], and classiﬁcation [11, 31, 32] tasks. Initial work has explored attention-maps by interpreting gradient of output class scores with respect to the input image. Trainable attention, on the other hand, is enforced by design and categorised as hard- and soft-attention. Hard attention [21], e.g. iterative region proposal and cropping, is often non-differentiable and relies on reinforcement learning for parameter updates, which makes model training more difﬁcult. Recursive hard-attention is used in [36] to detect anomalies in chest X-ray scans. Contrarily, soft attention is probabilistic and utilises standard back-propagation without need for Monte Carlo sampling. For instance, additive soft attention is used in sentence-to-sentence translation [2, 29] and more recently applied to image classiﬁcation [11, 32]. In [10], channel-wise attention is used to highlight important feature dimensions, which was the top-performer in the ILSVRC 2017 image classiﬁcation challenge. Self-attention techniques [11, 33] have been proposed to remove the dependency on external gating information. For instance, non-local self attention is used in [33] to capture long range dependencies. In [11, 32] self-attention is used to perform class-speciﬁc pooling, which results in more accurate and robust image classiﬁcation performance.
1.2 Contributions
In this paper, we propose a novel self-attention gating module that can be utilised in CNN based standard image analysis models for dense label predictions. Moreover, we explore the beneﬁt of AGs to medical image analysis, in particular, in the context of image segmentation. The contributions of this work can be summarised as follows:
2

Segmentation Map

D 1

W1 x

W1 x D1

W1 x D1

D 1

W1 x

H1 x

H1 x

H1 x

Nc x

F1 x

F1 x

W2 x D2

W2 x D2

W2 x D2

D 2

D 2

H1 x

Input Image
1 x H1 x W1 x D1

W2 x

W2 x

F1 x

H2 x

H2 x

H2 x

F1 x

F2 x

F2 x

W3 x D3

W3 x D3

W3 x D3

W3 x D3

W3 x D3

H2 x

H2 x

F2 x

F1 x

H3 x

H3 x

H3 x

F2 x

F3 x

F3 x

W4 x D4

W4 x D4

H3 x

H3 x

F3 x

F2 x

H4 x

H4 x

F4 x

F3 x

(Conv 3x3x3 + ReLU) (x2) Upsampling (by 2) Max-pooling (by 2) Skip Connection Gating Signal (Query) Concatenation Attention Gate
Figure 1: A block diagram of the proposed Attention U-Net segmentation model. Input image is progressively ﬁltered and downsampled by factor of 2 at each scale in the encoding part of the network (e.g. H4 = H1/8). Nc denotes the number of classes. Attention gates (AGs) ﬁlter the features propagated through the skip connections. Schematic of the AGs is shown in Figure 2. Feature selectivity in AGs is achieved by use of contextual information (gating) extracted in coarser scales.
• We take the attention approach proposed in [11] a step further by proposing grid-based gating that allows attention coefﬁcients to be more speciﬁc to local regions. This improves performance compared to gating based on a global feature vector. Moreover, our approach can be used for dense predictions since we do not perform adaptive pooling.
• We propose one of the ﬁrst use cases of soft-attention technique in a feed-forward CNN model applied to a medical imaging task. The proposed attention gates can replace hardattention approaches used in image classiﬁcation [36] and external organ localisation models in image segmentation frameworks [14, 22, 26, 27].
• An extension to the standard U-Net model is proposed to improve model sensitivity to foreground pixels without requiring complicated heuristics. Accuracy improvements over U-Net are experimentally observed to be consistent across different imaging datasets.
2 Methodology
Fully Convolutional Network (FCN): Convolutional neural networks (CNNs) outperform traditional approaches in medical image analysis on public benchmark datasets [14, 17] while being an order of magnitude faster than, e.g., graph-cut and multi-atlas segmentation techniques [34]. This is mainly attributed to the fact that (I) domain speciﬁc image features are learnt using stochastic gradient descent (SGD) optimisation, (II) learnt kernels are shared across all pixels, and (III) image convolution operations exploit the structural information in medical images well. In particular, fully convolutional networks (FCN) [18] such as U-Net [24], DeepMedic [13] and holistically nested networks [16, 35] have been shown to achieve robust and accurate performance in various tasks including cardiac MR [3], brain tumours [12] and abdominal CT [26, 27] image segmentation tasks. Convolutional layers progressively extract higher dimensional image representations (xl) by processing local information layer by layer. Eventually, this separates pixels in a high dimensional space according to their semantics. Through this sequential process, model predictions are conditioned on information collected from a large receptive ﬁeld. Hence, feature-map xl is obtained at the output of layer l by sequentially applying a linear transformation followed by a non-linear activation function. It is often chosen as rectiﬁed linear unit: σ1(xli,c) = max(0, xli,c) where i and c denote spatial and channel dimensions respectively. Feature activations can be formulated as: xlc = σ1 c ∈Fl xlc−1 ∗ kc ,c where ∗ denotes the convolution operation, and the spatial subscript (i) is omitted in the formulation for notational clarity. The function f (xl; Φl) = x(l+1) applied in convolution layer l is characterised by trainable kernel parameters Φl. The parameters are learnt by
3

Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.

x x x

ReLU

Sigmoid

Resampler

x

x x

xx x
Figure 2: Schematic of the proposed additive attention gate (AG). Input features (xl) are scaled with attention coefﬁcients (α) computed in AG. Spatial regions are selected by analysing both the activations and contextual information provided by the gating signal ( g ) which is collected from a coarser scale. Grid resampling of attention coefﬁcients is done using trilinear interpolation.

minimising a training objective, e.g. cross-entropy loss, using stochastic gradient descent (SGD). In this paper, we build our attention model on top of a standard U-Net architecture. U-Nets are commonly used for image segmentation tasks because of their good performance and efﬁcient use of GPU memory. The latter advantage is mainly linked to extraction of image features at multiple image scales. Coarse feature-maps capture contextual information and highlight the category and location of foreground objects. Feature-maps extracted at multiple scales are later merged through skip connections to combine coarse- and ﬁne-level dense predictions as shown in Figure 1.

Attention Gates for Image Analysis: To capture a sufﬁciently large receptive ﬁeld and thus, semantic contextual information, the feature-map grid is gradually downsampled in standard CNN architectures. In this way, features on the coarse spatial grid level model location and relationship between tissues at global scale. However, it remains difﬁcult to reduce false-positive predictions for small objects that show large shape variability. In order to improve the accuracy, current segmentation frameworks [14, 26, 27] rely on additional preceding object localisation models to simplify the task into separate localisation and subsequent segmentation steps. Here, we demonstrate that the same objective can be achieved by integrating attention gates (AGs) in a standard CNN model. This does not require the training of multiple models and a large number of extra model parameters. In contrast to the localisation model in multi-stage CNNs, AGs progressively suppress feature responses in irrelevant background regions without the requirement to crop a ROI between networks.

Attention coefﬁcients, αi ∈ [0, 1], identify salient image regions and prune feature responses to preserve only the activations relevant to the speciﬁc task as shown in Figure 3a. The output of AGs is the element-wise multiplication of input feature-maps and attention coefﬁcients: xˆli,c = xli,c · αil. In a default setting, a single scalar attention value is computed for each pixel vector xli ∈ RFl where Fl corresponds to the number of feature-maps in layer l. In case of multiple semantic classes, we propose to learn multi-dimensional attention coefﬁcients. This is inspired by [29], where multi-
dimensional attention coefﬁcients are used to learn sentence embeddings. Thus, each AG learns to focus on a subset of target structures. As shown in Figure 2, a gating vector gi ∈ RFg is used for each pixel i to determine focus regions. The gating vector contains contextual information to prune
lower-level feature responses as suggested in [32], which uses AGs for natural image classiﬁcation.
We use additive attention [2] to obtain the gating coefﬁcient. Although this is computationally more
expensive, it has experimentally shown to achieve higher accuracy than multiplicative attention [19].
Additive attention is formulated as follows:

qal tt = ψT σ1 ( WxT xli + WgT gi + bg ) + bψ

(1)

αil = σ2( qal tt(xli , gi ; Θatt) ),

(2)

where σ2(xi,c)

=

1 1+exp(−xi,c )

correspond to sigmoid activation function.

AG is characterised

by a set of parameters Θatt containing: linear transformations Wx ∈ RFl×Fint , Wg ∈ RFg×Fint ,

ψ ∈ RFint×1 and bias terms bψ ∈ R , bg ∈ RFint . The linear transformations are computed using

channel-wise 1x1x1 convolutions for the input tensors. In other contexts [33], this is referred to as

vector concatenation-based attention, where the concatenated features xl and g are linearly mapped

to a RFint dimensional intermediate space. In image captioning [1] and classiﬁcation [11] tasks, the

4

Figure 3(a): From left to right (a-e, f-j): Axial and sagittal views of a Figure 3(b): The ground-truth pancreas 3D abdominal CT scan, attention coefﬁcients, feature activations of segmentation (a) is highlighted in blue a skip connection before and after gating. Similarly, (k-n) visualise (b). Similarly, U-Net model prediction the gating on a coarse scale skip connection. The ﬁltered feature (c) and the predictions obtained with Atactivations (d-e, i-j) are collected from multiple AGs, where a subset tention U-Net (d) are shown. The missed of organs is selected by each gate. Activations shown in (d-e, i-j) dense predictions by U-Net are highconsistently correspond to speciﬁc structures across different scans. lighted with red arrows.

softmax activation function is used to normalise the attention coefﬁcients (σ2); however, sequential use of softmax yields sparser activations at the output. For this reason, we choose a sigmoid activation function. This results experimentally in better training convergence for the AG parameters. In contrast to [11] we propose a grid-attention technique. In this case, gating signal is not a global single vector for all image pixels but a grid signal conditioned to image spatial information. More importantly, the gating signal for each skip connection aggregates information from multiple imaging scales, as shown in Figure 1, which increases the grid-resolution of the query signal and achieve better performance. Lastly, we would like to note that AG parameters can be trained with the standard back-propagation updates without a need for sampling based update methods used in hard-attention [21].

Attention Gates in U-Net Model: The proposed AGs are incorporated into the standard U-Net architecture to highlight salient features that are passed through the skip connections, see Figure 1. Information extracted from coarse scale is used in gating to disambiguate irrelevant and noisy responses in skip connections. This is performed right before the concatenation operation to merge only relevant activations. Additionally, AGs ﬁlter the neuron activations during the forward pass as well as during the backward pass. Gradients originating from background regions are down weighted during the backward pass. This allows model parameters in shallower layers to be updated mostly based on spatial regions that are relevant to a given task. The update rule for convolution parameters in layer l − 1 can be formulated as follows:

∂(xˆli) ∂ (Φl−1)

=

∂

αil f (xli−1; Φl−1) ∂ (Φl−1)

=

αil

∂(f (xli−1; Φl−1)) ∂ (Φl−1)

+

∂ (αil ) ∂ (Φl−1)

xli

(3)

The ﬁrst gradient term on the right-hand side is scaled with αil. In case of multi-dimensional AGs, αil corresponds to a vector at each grid scale. In each sub-AG, complementary information is extracted and fused to deﬁne the output of skip connection. To reduce the number of trainable parameters and computational complexity of AGs, the linear transformations are performed without any spatial support (1x1x1 convolutions) and input feature-maps are downsampled to the resolution of gating signal, similar to non-local blocks [33]. The corresponding linear transformations decouple the feature-maps and map them to lower dimensional space for the gating operation. As suggested in [11], low-level feature-maps, i.e. the ﬁrst skip connections, are not used in the gating function since they do not represent the input data in a high dimensional space. We use deep-supervision [16] to force the intermediate feature-maps to be semantically discriminative at each image scale. This helps to ensure that attention units, at different scales, have an ability to inﬂuence the responses to a large range of image foreground content. We therefore prevent dense predictions from being reconstructed from small subsets of skip connections.

3 Experiments and Results
The proposed AG model is modular and independent of application type; as such it can be easily adapted for classiﬁcation and regression tasks. To demonstrate its applicability to image segmentation,

5

Figure 4: The ﬁgure shows the attention coefﬁcients (αls2 , αls3 ) across different training epochs (3, 6, 10, 60, 150). The images are extracted from sagittal and axial planes of a 3D abdominal CT scan from the testing dataset. The model gradually learns to focus on the pancreas, kidney, and spleen.
we evaluate the Attention U-Net model on a challenging abdominal CT multi-label segmentation problem. In particular, pancreas boundary delineation is a difﬁcult task due to shape-variability and poor tissue contrast. Our model is compared against the standard 3D U-Net in terms of segmentation performance, model capacity, computation time, and memory requirements.
Evaluation Datasets: For the experiments, two different CT abdominal datasets are used: (I) 150 abdominal 3D CT scans acquired from patients diagnosed with gastric cancer (CT -150). In all images, the pancreas, liver, and spleen boundaries were semi-automatically delineated by three trained researchers and manually veriﬁed by a clinician. The same dataset is used in [27] to benchmark the U-Net model in pancreas segmentation. (II) The second dataset1 (CT -82) consists of 82 contrast enhanced 3D CT scans with pancreas manual annotations performed slice-by-slice. This dataset (NIH-TCIA) [25] is publicly available and commonly used to benchmark CT pancreas segmentation frameworks. The images from both datasets are downsampled to isotropic 2.00 mm resolution due to the large image size and hardware memory limitations.
Implementation Details: In contrast to the state-of-the-art CNN segmentation frameworks [4, 26], we propose a 3D-model to capture sufﬁcient semantic context. Gradient updates are computed using small batch sizes of 2 to 4 samples. For larger networks, gradient averaging is used over multiple forward and backward passes. All models are trained using the Adam optimiser [15], batch-normalisation, deep-supervision [16], and standard data-augmentation techniques (afﬁne transformations, axial ﬂips, random crops). Intensity values are linearly scaled to obtain a normal distribution N (0, 1). The models are trained using the Sorensen-Dice loss [20] deﬁned over all semantic classes, which is experimentally shown to be less sensitive to class imbalance. Gating parameters are initialised so that attention gates pass through feature vectors at all spatial locations. Moreover, we do not require multiple training stages as in hard-attention based approaches therefore simplifying the training procedure. Our implementation using PyTorch is publicly available2.
Attention Map Analysis: The attention coefﬁcients obtained from test images are visualised with respect to training epochs (see Figure 4). We commonly observe that AGs initially have a uniform distribution and pass features at all locations. This is gradually updated and localised towards the targeted organ boundaries. Additionally, at coarser scales AGs provide a rough outline of organs which are gradually reﬁned at ﬁner resolutions. Moreover, by training multiple AGs at each image scale, we observe that each AG learns to focus on a particular subset of organs.
Segmentation Experiments: The proposed Attention U-Net model is benchmarked against the standard U-Net on multi-class abdominal CT segmentation. We use CT -150 dataset for both training (120) and testing (30). The corresponding Dice scores (DSC) and surface distances (S2S) are given in Table 1. The results on pancreas predictions demonstrate that attention gates (AGs) increase recall values (p = .005) by improving the model’s expression power as it relies on AGs to localise foreground pixels. The difference between predictions obtained with these two models are qualitatively compared in Figure 3b. In the second experiment, the same models are trained with fewer training images (30) to show that the performance improvement is consistent and signiﬁcant for different sizes of training data (p = .01). For both approaches, we observe a performance drop on
1https://wiki.cancerimagingarchive.net/display/Public/Pancreas-CT 2https://github.com/ozan-oktay/Attention-Gated-Networks
6

Table 1: Multi-class CT abdominal segmentation results obtained on the CT -150 dataset: The results are reported in terms of Dice score (DSC) and mesh surface to surface distances (S2S). These distances are reported only for the pancreas segmentations. The proposed Attention U-Net model is benchmarked against the standard U-Net model for different training and testing splits. Inference time (forward pass) of the models are computed for input tensor of size 160 × 160 × 96. Statistically signiﬁcant results are highlighted in bold font.

Method (Train/Test Split) U-Net (120/30) Att U-Net (120/30) U-Net (30/120) Att U-Net (30/120)

Pancreas DSC Pancreas Precision Pancreas Recall Pancreas S2S Dist (mm)

0.814±0.116 0.848±0.110 0.806±0.126 2.358±1.464

0.840±0.087 0.849±0.098 0.841±0.092 1.920±1.284

0.741±0.137 0.789±0.176 0.743±0.179 3.765±3.452

0.767±0.132 0.794±0.150 0.762±0.145 3.507±3.814

Spleen DSC Kidney DSC Number of Params Inference Time

0.962±0.013 0.963±0.013
5.88 M 0.167 s

0.965±0.013 0.964±0.016
6.40 M 0.179 s

0.935±0.095 0.951±0.019
5.88 M 0.167 s

0.943±0.092 0.954±0.021
6.40 M 0.179 s

Table 2: Segmentation experiments on CT -150 dataset are repeated with higher capacity U-Net models to demonstrate the efﬁcieny of the attention models with similar or less network capacity. The additional ﬁlters in the U-Net model are distributed uniformly across all the layers.

Method

Panc. DSC Panc. Precision Panc. Recall S2S Dist (mm) # of Pars Run Time

U-Net (120/30) 0.821±.119 U-Net (120/30) 0.825±.104

0.849±.111 0.861±.082

0.814±.125 0.807±.121

2.383±1.918 6.44 M 2.202±1.144 10.40 M

0.191 s 0.222 s

Table 3: Pancreas segmentation results obtained on the TCIA Pancreas-CT Dataset [25]. The dataset contains in total 82 scans which are split into training (61) and testing (21) sets. The corresponding results are obtained before (BFT) and after ﬁne tuning (AFT) and also training the models from scratch (SCR). Statistically signiﬁcant results are highlighted in bold font.

Method

Dice Score

Precision

Recall

S2S Dist (mm)

SCR AFT BFT

U-Net [24]

0.690±0.132 0.680±0.109 0.733±0.190 6.389±3.900

Attention U-Net 0.712±0.110 0.693±0.115 0.751±0.149 5.251±2.551

U-Net [24]

0.820±0.043 0.824±0.070 0.828±0.064 2.464±0.529

Attention U-Net 0.831±0.038 0.825±0.073 0.840±0.053 2.305±0.568

U-Net [24]

0.815±0.068 0.815±0.105 0.826±0.062 2.576±1.180

Attention U-Net 0.821±0.057 0.815±0.093 0.835±0.057 2.333±0.856

spleen DSC as the training size is reduced. The drop is less signiﬁcant with the proposed framework. For kidney segmentation, the models achieve similar accuracy since the tissue contrast is higher.
In Table 1, we also report the number of trainable parameters for both models. We observe that by adding 8% extra capacity to the standard U-Net, the performance can be improved by 2-3% in terms of DSC. For a fair comparison, we also train higher capacity U-Net models and compare against the proposed model with smaller network size. The results shown in Table 2 demonstrate that the addition of AGs contributes more than simply increasing model capacity (uniformly) across all layers of the network (p = .007). Therefore, additional capacity should be used for AGs to localise tissues, in cases when AGs are used to reduce the redundancy of training multiple, individual models.
Comparison to State-of-the-Art: The proposed architecture is evaluated on the public TCIA CT Pancreas benchmark to compare its performance with state-of-the-art methods. Initially, the models trained on CT -150 dataset are directly applied to CT -82 dataset to observe the applicability of the two models on different datasets. The corresponding results (BFT) are given in Table 3. U-Net model outperforms traditional atlas techniques [34] although it was trained on a disjoint dataset. Moreover, the attention model performs consistently better in pancreas segmentation across different datasets. These models are later ﬁne-tuned (AFT) on a subset of TCIA dataset (61 train, 21 test). The output nodes corresponding to spleen and kidney are excluded from the output softmax computation, and the gradient updates are computed only for the background and pancreas labels. The results in Table 3 and
7

Table 4: State-of-the-art CT pancreas segmentation methods that are based on single and multiple CNN models. The listed segmentation frameworks are evaluated on the same public benchmark (CT -82) using different number of training and testing images. Similarly, the FCN approach proposed in [27] is benchmarked on CT -150 although it is trained on an external dataset (Ext).

Method

Dataset

Pancreas DSC Train/Test # Folds

Hierarchical 3D FCN [27]
Dense-Dilated FCN [6] 2D U-Net [8] Holistically Nested 2D FCN Stage-1[26] Holistically Nested 2D FCN Stage-2[26] 2D FCN [4] 2D FCN + Recurrent Network [4] Single Model 2D FCN [38] Multi-Model 2D FCN [38]

CT -150 CT -82 & Synapse3
CT -82 CT -82 CT -82 CT -82 CT -82 CT -82 CT -82

82.2 ± 10.2
66.0 ± 10.0 75.7 ± 9.0 76.8 ± 11.1 81.2 ± 7.3 80.3 ± 9.0 82.3 ± 6.7 75.7 ± 10.5 82.2 ± 5.7

Ext/150 63/9 66/16 62/20 62/20 62/20 62/20 62/20 62/20

-
5-CV 5-CV 4-CV 4-CV 4-CV 4-CV 4-CV 4-CV

4 show improved performance compared to concatenated multi-model CNN approaches [4, 26, 38] due to additional training data and richer semantic information (e.g. spleen labels). Additionally, we trained the two models from scratch (SCR) with 61 training images randomly selected from the CT -82 dataset. Similar to the results on CT -150 dataset, AGs improve the segmentation accuracy and lower the surface distances (p = .03) due to increased recall rate of pancreas pixels (p = .09).
Results from state-of-the-art CT pancreas segmentation models are summarised in Table 4 for comparison purposes. Since the models are trained on the same training dataset, this comparison gives an insight on how the attention model compares to the relevant literature. It is important to note that, post-processing (e.g. conditional random ﬁeld) is not utilised in our framework as the experiments mainly focus on quantiﬁcation of performance improvement brought by AGs in an isolated setting. Similarly, residual and dense connections can be used as in [6] in conjunction with AGs to improve the segmentation results. In that regard, our 3D Attention U-Net model performs similar to the state-of-the-art, despite the input images are downsampled to lower resolution. More importantly, our approach signiﬁcantly improves the results compared to single-model based segmentation frameworks (see Table 4). We do not require multiple CNN models to localise and segment object boundaries. Lastly, we performed 5-fold cross-validation on the CT -82 dataset using the Attention U-Net for a better comparison, which achieved 81.48 ± 6.23 DSC for pancreas labels.
4 Discussion and Conclusion
In this paper, we presented a novel attention gate model applied to medical image segmentation. Our approach eliminates the necessity of applying an external object localisation model. The proposed approach is generic and modular as such it can be easily applied to image classiﬁcation and regression problems as in the examples of natural image analysis and machine translation. Experimental results demonstrate that the proposed AGs are highly beneﬁcial for tissue/organ identiﬁcation and localisation. This is particularly true for variable small size organs such as the pancreas, and similar behaviour is expected for global classiﬁcation tasks.
Training behaviour of the AGs can beneﬁt from transfer learning and multi-stage training schemes. For instance, pre-trained U-Net weights can be used to initialise the attention network, and gates can be trained accordingly in the ﬁne-tuning stage. Similarly, there is a vast body of literature in machine learning exploring different gating architectures. For example, highway networks [7] make use of residual connections around the gate block to allow better gradient backpropagation and slightly softer attention mechanisms. Although our experiments with residual connections have not provided any signiﬁcant performance improvement, future research will focus on this aspect to obtain a better training behaviour. Lastly, we note that with the advent of improved GPU computation power and memory, larger capacity 3D models can be trained with larger batch sizes without the need for image downsampling. In this way, we would not need to utilise ad-hoc post-processing techniques to further improve the state-of-the-art results. Similarly, the performance of Attention U-Net can be further enhanced by utilising ﬁne resolution input batches without additional heuristics. Lastly, we would like to thank to Salim Arslan and Dan Busbridge for their helpful comments on this work.
8

References
[1] Anderson, P., He, X., Buehler, C., Teney, D., Johnson, M., Gould, S., Zhang, L.: Bottom-up and top-down attention for image captioning and vqa. arXiv preprint arXiv:1707.07998 (2017)
[2] Bahdanau, D., Cho, K., Bengio, Y.: Neural machine translation by jointly learning to align and translate. arXiv preprint arXiv:1409.0473 (2014)
[3] Bai, W., Sinclair, M., Tarroni, G., Oktay, O., Rajchl, M., Vaillant, G., Lee, A.M., Aung, N., Lukaschuk, E., Sanghvi, M.M., et al.: Human-level CMR image analysis with deep fully convolutional networks. arXiv preprint arXiv:1710.09289 (2017)
[4] Cai, J., Lu, L., Xie, Y., Xing, F., Yang, L.: Improving deep pancreas segmentation in CT and MRI images via recurrent neural contextual learning and direct loss function. In: MICCAI (2017)
[5] Cerrolaza, J.J., Summers, R.M., Linguraru, M.G.: Soft multi-organ shape models via generalized PCA: A general framework. In: MICCAI. pp. 219–228. Springer (2016)
[6] Gibson, E., Giganti, F., Hu, Y., Bonmati, E., Bandula, S., Gurusamy, K., Davidson, B.R., Pereira, S.P., Clarkson, M.J., Barratt, D.C.: Towards image-guided pancreas and biliary endoscopy: Automatic multi-organ segmentation on abdominal CT with dense dilated networks. In: MICCAI. pp. 728–736. Springer (2017)
[7] Greff, K., Srivastava, R.K., Schmidhuber, J.: Highway and residual networks learn unrolled iterative estimation. arXiv preprint arXiv:1612.07771 (2016)
[8] Heinrich, M.P., Blendowski, M., Oktay, O.: TernaryNet: Faster deep model inference without GPUs for medical 3D segmentation using sparse and binary convolutions. arXiv preprint arXiv:1801.09449 (2018)
[9] Heinrich, M.P., Oktay, O.: BRIEFnet: Deep pancreas segmentation using binary sparse convolutions. In: MICCAI. pp. 329–337. Springer (2017)
[10] Hu, J., Shen, L., Sun, G.: Squeeze-and-excitation networks. arXiv:1709.01507 (2017)
[11] Jetley, S., Lord, N.A., Lee, N., Torr, P.: Learn to pay attention. In: International Conference on Learning Representations (2018), https://openreview.net/forum?id=HyzbhfWRW
[12] Kamnitsas, K., Bai, W., Ferrante, E., McDonagh, S., Sinclair, M., Pawlowski, N., Rajchl, M., Lee, M., Kainz, B., Rueckert, D., Glocker, B.: Ensembles of multiple models and architectures for robust brain tumour segmentation. In: Brainlesion: Glioma, Multiple Sclerosis, Stroke and Traumatic Brain Injuries. pp. 450–462. Cham (2018)
[13] Kamnitsas, K., Ledig, C., Newcombe, V.F., Simpson, J.P., Kane, A.D., Menon, D.K., Rueckert, D., Glocker, B.: Efﬁcient multi-scale 3D CNN with fully connected CRF for accurate brain lesion segmentation. Medical image analysis 36, 61–78 (2017)
[14] Khened, M., Kollerathu, V.A., Krishnamurthi, G.: Fully convolutional multi-scale residual densenets for cardiac segmentation and automated cardiac diagnosis using ensemble of classiﬁers. arXiv preprint arXiv:1801.05173 (2018)
[15] Kingma, D.P., Ba, J.: Adam: A method for stochastic optimization. arXiv preprint arXiv:1412.6980 (2014)
[16] Lee, C.Y., Xie, S., Gallagher, P., Zhang, Z., Tu, Z.: Deeply-supervised nets. In: Artiﬁcial Intelligence and Statistics. pp. 562–570 (2015)
[17] Liao, F., Liang, M., Li, Z., Hu, X., Song, S.: Evaluate the malignancy of pulmonary nodules using the 3D deep leaky noisy-or network. arXiv preprint arXiv:1711.08324 (2017)
[18] Long, J., Shelhamer, E., Darrell, T.: Fully convolutional networks for semantic segmentation. In: IEEE CVPR. pp. 3431–3440 (2015)
9

[19] Luong, M.T., Pham, H., Manning, C.D.: Effective approaches to attention-based neural machine translation. arXiv preprint arXiv:1508.04025 (2015)
[20] Milletari, F., Navab, N., Ahmadi, S.A.: V-net: Fully convolutional neural networks for volumetric medical image segmentation. In: 3D Vision. pp. 565–571. IEEE (2016)
[21] Mnih, V., Heess, N., Graves, A., et al.: Recurrent models of visual attention. In: Advances in neural information processing systems. pp. 2204–2212 (2014)
[22] Oda, M., Shimizu, N., Roth, H.R., Karasawa, K., Kitasaka, T., Misawa, K., Fujiwara, M., Rueckert, D., Mori, K.: 3D FCN feature driven regression forest-based pancreas localization and segmentation. In: DLMI, pp. 222–230. Springer (2017)
[23] Payer, C., Štern, D., Bischof, H., Urschler, M.: Multi-label whole heart segmentation using CNNs and anatomical label conﬁgurations. In: STACOM. pp. 190–198. Springer (2017)
[24] Ronneberger, O., Fischer, P., Brox, T.: U-net: Convolutional networks for biomedical image segmentation. In: MICCAI. pp. 234–241. Springer (2015)
[25] Roth, H., Farag, A., Turkbey, E.B., Lu, L., Liu, J., Summers, R.M.: Data from Pancreas-CT. The Cancer Imaging Archive (2016), http://doi.org/10.7937/K9/TCIA.2016.tNB1kqBU
[26] Roth, H.R., Lu, L., Lay, N., Harrison, A.P., Farag, A., Sohn, A., Summers, R.M.: Spatial aggregation of holistically-nested convolutional neural networks for automated pancreas localization and segmentation. Medical Image Analysis 45, 94 – 107 (2018)
[27] Roth, H.R., Oda, H., Hayashi, Y., Oda, M., Shimizu, N., Fujiwara, M., Misawa, K., Mori, K.: Hierarchical 3D fully convolutional networks for multi-organ segmentation. arXiv preprint arXiv:1704.06382 (2017)
[28] Saito, A., Nawano, S., Shimizu, A.: Joint optimization of segmentation and shape prior from level-set-based statistical shape model, and its application to the automated segmentation of abdominal organs. Medical image analysis 28, 46–65 (2016)
[29] Shen, T., Zhou, T., Long, G., Jiang, J., Pan, S., Zhang, C.: Disan: Directional self-attention network for rnn/cnn-free language understanding. arXiv preprint arXiv:1709.04696 (2017)
[30] Vaswani, A., Shazeer, N., Parmar, N., Uszkoreit, J., Jones, L., Gomez, A.N., Kaiser, Ł., Polosukhin, I.: Attention is all you need. In: NIPS. pp. 6000–6010 (2017)
[31] Velicˇkovic´, P., Cucurull, G., Casanova, A., Romero, A., Liò, P., Bengio, Y.: Graph attention networks. arXiv preprint arXiv:1710.10903 (2017)
[32] Wang, F., Jiang, M., Qian, C., Yang, S., Li, C., Zhang, H., Wang, X., Tang, X.: Residual attention network for image classiﬁcation. In: IEEE CVPR. pp. 3156–3164 (2017)
[33] Wang, X., Girshick, R., Gupta, A., He, K.: Non-local neural networks. arXiv preprint arXiv:1711.07971 (2017)
[34] Wolz, R., Chu, C., Misawa, K., Fujiwara, M., Mori, K., Rueckert, D.: Automated abdominal multi-organ segmentation with subject-speciﬁc atlas generation. IEEE TMI 32(9) (2013)
[35] Xie, S., Tu, Z.: Holistically-nested edge detection. In: Proceedings of the IEEE international conference on computer vision. pp. 1395–1403 (2015)
[36] Ypsilantis, P.P., Montana, G.: Learning what to look in chest X-rays with a recurrent visual attention model. arXiv preprint arXiv:1701.06452 (2017)
[37] Yu, Q., Xie, L., Wang, Y., Zhou, Y., Fishman, E.K., Yuille, A.L.: Recurrent saliency transformation network: Incorporating multi-stage visual cues for small organ segmentation. arXiv preprint arXiv:1709.04518 (2017)
[38] Zhou, Y., Xie, L., Shen, W., Wang, Y., Fishman, E.K., Yuille, A.L.: A ﬁxed-point model for pancreas segmentation in abdominal CT scans. In: MICCAI. pp. 693–701. Springer (2017)
[39] Zografos, V., Valentinitsch, A., Rempﬂer, M., Tombari, F., Menze, B.: Hierarchical multi-organ segmentation without registration in 3D abdominal CT images. In: International MICCAI Workshop on Medical Computer Vision. pp. 37–46. Springer (2015)
10

